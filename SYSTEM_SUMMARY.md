# 小区房屋租赁管理平台 - 系统总览

## 文档索引

本系统文档由以下部分组成：

| 文档 | 内容 |
|------|------|
| [SYSTEM_DOCUMENTATION.md](SYSTEM_DOCUMENTATION.md) | 系统概述、技术架构、角色权限、功能模块、用例 |
| [SYSTEM_FLOWCHARTS.md](SYSTEM_FLOWCHARTS.md) | 业务流程图、时序图 |
| [SYSTEM_API_REFERENCE.md](SYSTEM_API_REFERENCE.md) | API接口文档 |
| [SYSTEM_DATABASE.md](SYSTEM_DATABASE.md) | 数据库设计、ER图 |

---

## 系统功能总览

### 核心功能模块 (17个)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        小区房屋租赁管理平台                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ 1.用户认证   │  │ 2.房源管理   │  │ 3.预约看房   │  │ 4.电子合同   │    │
│  │ AuthService │  │HouseService │  │Appointment  │  │ContractSvc  │    │
│  │ ·微信登录   │  │ ·发布房源   │  │ ·创建预约   │  │ ·创建合同   │    │
│  │ ·管理员登录 │  │ ·搜索房源   │  │ ·确认/拒绝  │  │ ·电子签名   │    │
│  │ ·Token管理  │  │ ·审核房源   │  │ ·完成预约   │  │ ·PDF生成   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ 5.实时聊天   │  │ 6.小区管理   │  │ 7.小区认证   │  │ 8.租赁交易   │    │
│  │ ChatService │  │CommunitySvc │  │Verification │  │TransactionSvc│   │
│  │ ·WebSocket  │  │ ·小区列表   │  │ ·提交认证   │  │ ·入住确认   │    │
│  │ ·消息推送   │  │ ·配套设施   │  │ ·双级审核   │  │ ·退租确认   │    │
│  │ ·敏感词过滤 │  │ ·设施管理   │  │ ·认证状态   │  │ ·状态流转   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ 9.租金支付   │  │10.信用评价   │  │ 11.社区论坛  │  │ 12.举报管理  │    │
│  │ PaymentSvc  │  │EvaluationSvc│  │ ForumService│  │ReportService│    │
│  │ ·账单生成   │  │ ·双向评价   │  │ ·发布帖子   │  │ ·提交举报   │    │
│  │ ·支付确认   │  │ ·信用分计算 │  │ ·回复帖子   │  │ ·处理举报   │    │
│  │ ·支付争议   │  │ ·评价统计   │  │ ·帖子管理   │  │ ·举报通知   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │13.系统通知   │  │14.AI内容审核 │  │15.敏感词过滤 │  │ 16.文件上传  │    │
│  │Notification │  │AiModeration │  │SensitiveWord│  │ MinioService│    │
│  │ ·实时推送   │  │ ·违规检测   │  │ ·DFA算法    │  │ ·图片上传   │    │
│  │ ·批量发送   │  │ ·自动处罚   │  │ ·词库管理   │  │ ·文件管理   │    │
│  │ ·已读管理   │  │ ·定时审核   │  │ ·内容替换   │  │ ·URL生成   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                         │
│  ┌─────────────┐                                                        │
│  │ 17.定时任务  │                                                        │
│  │ScheduledTask│                                                        │
│  │ ·会话清理   │                                                        │
│  │ ·到期提醒   │                                                        │
│  │ ·健康检查   │                                                        │
│  └─────────────┘                                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 技术亮点

### 1. 安全特性
- **Sa-Token认证**: 分布式Token管理，支持多端登录
- **BCrypt加密**: 密码安全存储
- **SHA256哈希**: 合同防篡改验证
- **敏感词过滤**: DFA算法实时过滤

### 2. AI能力
- **qwen-plus大模型**: 阿里云百炼服务
- **智能内容审核**: 7种违规类型检测
- **自动处罚机制**: 严重违规自动封禁

### 3. 实时通讯
- **WebSocket**: 即时消息推送
- **心跳机制**: 30秒心跳保活
- **在线状态**: 实时在线检测

### 4. 电子合同
- **iTextPDF**: 专业PDF生成
- **电子签名**: 手写签名数据存储
- **完整性验证**: SHA256哈希校验

### 5. 分布式存储
- **MinIO**: 对象存储服务
- **图片管理**: 房源图片、签名图片、证明材料

---

## 角色功能矩阵

| 功能 | 租客 | 房东 | 小区管理员 | 平台管理员 |
|------|:----:|:----:|:----------:|:----------:|
| 浏览房源 | ✓ | ✓ | ✓ | ✓ |
| 收藏房源 | ✓ | ✓ | - | - |
| 预约看房 | ✓ | - | - | - |
| 发布房源 | - | ✓ | - | - |
| 管理房源 | - | ✓ | - | - |
| 创建合同 | - | ✓ | - | - |
| 签署合同 | ✓ | ✓ | - | - |
| 实时聊天 | ✓ | ✓ | ✓ | ✓ |
| 发布论坛 | ✓ | ✓ | ✓ | ✓ |
| 提交举报 | ✓ | ✓ | ✓ | ✓ |
| 审核房源 | - | - | ✓ | ✓ |
| 审核认证 | - | - | ✓(一级) | ✓(二级) |
| 审核合同 | - | - | ✓ | ✓ |
| 处理举报 | - | - | ✓ | ✓ |
| 管理配套 | - | - | ✓ | ✓ |
| 管理用户 | - | - | - | ✓ |
| 管理小区 | - | - | - | ✓ |
| 管理管理员 | - | - | - | ✓ |
| 全局统计 | - | - | - | ✓ |

---

## 核心业务流程

### 1. 租房完整流程
```
注册登录 → 小区认证 → 浏览房源 → 预约看房 → 签署合同 → 确认入住 → 支付租金 → 退租评价
```

### 2. 发布房源流程
```
小区认证通过 → 填写房源信息 → 上传图片 → 提交审核 → 管理员审核 → 上架展示
```

### 3. 合同签署流程
```
房东创建草稿 → 房东签名 → 租客签名 → 管理员审核 → 生成PDF → 合同生效
```

### 4. 双级认证流程
```
提交申请 → 小区管理员审核 → 平台管理员审核 → 认证通过
```

---

## 接口统计

| 模块 | 接口数量 |
|------|----------|
| 认证模块 | 6 |
| 用户模块 | 4 |
| 房源模块 | 12 |
| 预约模块 | 7 |
| 合同模块 | 8 |
| 聊天模块 | 5 |
| 小区模块 | 7 |
| 认证模块 | 4 |
| 论坛模块 | 10 |
| 评价模块 | 5 |
| 交易模块 | 5 |
| 支付模块 | 3 |
| 举报模块 | 3 |
| 通知模块 | 5 |
| 文件模块 | 3 |
| 房东模块 | 5 |
| 管理模块 | 25+ |
| **总计** | **100+** |

---

## 数据表统计

| 类型 | 数量 | 说明 |
|------|------|------|
| 用户相关 | 3 | user, admin, community_verification |
| 房源相关 | 3 | house, house_image, favorite |
| 交易相关 | 4 | appointment, rental_contract, rental_transaction, rent_payment |
| 聊天相关 | 2 | chat_message, websocket_session |
| 社区相关 | 4 | community, community_facility, facility_feedback, forum_post, forum_reply |
| 评价举报 | 3 | credit_evaluation, report, violation |
| 系统相关 | 2 | system_notification, sensitive_word |
| **总计** | **22** | |

---

## 部署信息

| 组件 | 端口 | 说明 |
|------|------|------|
| Spring Boot | 8888 | 后端API服务 |
| MySQL | 3306 | 数据库 |
| Redis | 6379 | 缓存/Session |
| MinIO | 9000 | 文件存储 |
| WebSocket | 8888 | 实时通讯(同API) |

---

## 配置要点

```properties
# 数据库
spring.datasource.url=jdbc:mysql://localhost:3306/houserent_system

# Redis
spring.data.redis.host=localhost
spring.data.redis.port=6379

# MinIO
minio.endpoint=http://172.31.14.194:9000
minio.bucket-name=houserent

# Sa-Token
sa-token.token-name=satoken
sa-token.timeout=86400

# AI服务
spring.ai.dashscope.chat.options.model=qwen-plus
```

---

## 版本信息

- **Spring Boot**: 3.5.8
- **MyBatis-Plus**: 3.5.8
- **Sa-Token**: 1.44.0
- **MinIO**: 8.5.12
- **iTextPDF**: 5.5.13.3
- **sensitive-word**: 0.20.0

---

*文档生成时间: 2024*
